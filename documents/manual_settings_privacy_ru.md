# Руководство по настройке режима конфиденциальности (Privacy Mode)

## Содержание

1. [Введение](#введение)
2. [Что такое режим конфиденциальности](#что-такое-режим-конфиденциальности)
3. [Файл конфигурации](#файл-конфигурации)
4. [Параметры настройки](#параметры-настройки)
   - [PRIVACY_MODE](#privacy_mode)
   - [UNLOCK_GESTURE](#unlock_gesture)
   - [UNLOCK_PATTERN](#unlock_pattern)
   - [AUTO_LOCK_MINUTES](#auto_lock_minutes)
   - [DEBUG_MODE](#debug_mode)
5. [Схема сетки паттерна](#схема-сетки-паттерна)
6. [Примеры конфигурации](#примеры-конфигурации)
7. [Сборка проекта](#сборка-проекта)
8. [Можно ли изменить настройки после сборки?](#можно-ли-изменить-настройки-после-сборки)
9. [Рекомендации по безопасности](#рекомендации-по-безопасности)
10. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

---

## Введение

Данное руководство описывает настройку режима конфиденциальности (Privacy Mode) в приложении Camera ZeroDay. Режим конфиденциальности позволяет скрыть приложение камеры за игрой 2048.

## Что такое режим конфиденциальности

Режим конфиденциальности — это функция безопасности, которая:

- **Скрывает** интерфейс камеры за полностью функциональной игрой 2048
- **Меняет** иконку и заголовок вкладки браузера на "2048"
- **Требует** секретный жест для доступа к камере
- **Автоматически скрывает** камеру после периода бездействия

При включённом режиме конфиденциальности:
1. Приложение отображает игру 2048 вместо камеры
2. Заголовок вкладки меняется с "Camera ZeroDay" на "2048"
3. Иконка сайта меняется на иконку игры
4. Для доступа к камере требуется ввести секретный жест

---

## Файл конфигурации

Все настройки режима конфиденциальности находятся в файле:

```
client/src/config.ts
```

### Структура файла

```typescript
export type GestureType = 'quickTaps' | 'patternUnlock';

export const CONFIG = {
  PRIVACY_MODE: true,
  UNLOCK_GESTURE: 'patternUnlock' as GestureType,
  UNLOCK_PATTERN: '0-4-8',  // Формат: цифры через дефисы
  AUTO_LOCK_MINUTES: 1,
  DEBUG_MODE: false,
} as const;
```

---

## Параметры настройки

### PRIVACY_MODE

**Тип:** `boolean` (true/false)

**Описание:** Главный переключатель режима конфиденциальности.

| Значение | Эффект |
|----------|--------|
| `true`   | Режим конфиденциальности **принудительно включён** для всех пользователей. Камера скрыта. Пользователи **не могут** отключить режим конфиденциальности в настройках. |
| `false`  | Режим конфиденциальности **опциональный**. Пользователи могут включать/выключать его в настройках приложения. |

**Пример:**
```typescript
// Камера скрыта, все видят только игру 2048
PRIVACY_MODE: true,

// Пользователи сами решают, включать ли конфиденциальность
PRIVACY_MODE: false,
```

---

### UNLOCK_GESTURE

**Тип:** `'quickTaps' | 'patternUnlock'`

**Описание:** Тип секретного жеста для разблокировки камеры.

| Значение | Описание | Рекомендация |
|----------|----------|--------------|
| `'quickTaps'` | 4 быстрых нажатия на экран игры | ⚠️ **Не рекомендуется** — имеет уязвимость безопасности |
| `'patternUnlock'` | 3 нажатия открывают сетку → нужно нарисовать паттерн | ✅ **Рекомендуется** — более безопасный вариант |

**Как работает каждый тип:**

#### quickTaps (Быстрые нажатия)
1. Пользователь находится в игре 2048
2. Делает 4 быстрых нажатия в любом месте экрана (в течение 1 секунды)
3. Камера разблокируется

#### patternUnlock (Разблокировка паттерном)
1. Пользователь находится в игре 2048
2. Делает 5 быстрых нажатий (в течение 0.8 секунды)
3. Появляется сетка 3x3 для ввода паттерна
4. Пользователь рисует секретный паттерн
5. Если паттерн правильный — камера разблокируется

**Пример:**
```typescript
// Рекомендуемый вариант - паттерн
UNLOCK_GESTURE: 'patternUnlock' as GestureType,

// Не рекомендуется из-за уязвимости
UNLOCK_GESTURE: 'quickTaps' as GestureType,
```

---

### UNLOCK_PATTERN

**Тип:** `string`

**Описание:** Секретный паттерн для режима `'patternUnlock'`. Это последовательность цифр, **разделённых дефисами**, представляющих точки на сетке 3x3.

**Формат:** Строка из цифр, разделённых дефисами (`-`), где каждая цифра — номер точки на сетке.

**Сетка паттерна:**
```
┌───┬───┬───┐
│ 0 │ 1 │ 2 │
├───┼───┼───┤
│ 3 │ 4 │ 5 │
├───┼───┼───┤
│ 6 │ 7 │ 8 │
└───┴───┴───┘
```

> **Важно:** 
> - Нумерация начинается с **0**, не с 1!
> - Цифры **обязательно** разделяются дефисами: `'0-4-8'`, НЕ `'048'`

**Примеры паттернов:**

| Паттерн | Визуализация | Описание |
|---------|--------------|----------|
| `'0-2-6-8'` | Диагональный крест | Все 4 угла |
| `'0-1-2'` | Верхняя линия | Три точки сверху (слишком короткий!) |
| `'0-4-8'` | Диагональ ↘ | Из верхнего левого в нижний правый |
| `'2-4-6'` | Диагональ ↙ | Из верхнего правого в нижний левый |
| `'0-1-2-5-8-7-6-3'` | Буква "П" | По периметру |
| `'4-1-2-5-8-7-6-3-0'` | Спираль | Из центра наружу |

**Минимальная длина паттерна:** 4 точки

**Пример:**
```typescript
// Диагональ: верхний левый → центр → нижний правый
UNLOCK_PATTERN: '0-4-8',

// Z-образный паттерн
UNLOCK_PATTERN: '0-1-2-4-6-7-8',

// L-образный паттерн (5 точек)
UNLOCK_PATTERN: '0-3-6-7-8',
```

---

### AUTO_LOCK_MINUTES

**Тип:** `number`

**Описание:** Время бездействия (в минутах), после которого камера автоматически скрывается и возвращается игра 2048.

| Значение | Эффект |
|----------|--------|
| `0`      | Автоблокировка **отключена** |
| `1-30`   | Камера скроется через указанное количество минут бездействия |

**Бездействие определяется как отсутствие:**
- Движения мыши
- Нажатий на экран (touch)
- Нажатий клавиш

**Пример:**
```typescript
// Камера скроется через 5 минут бездействия
AUTO_LOCK_MINUTES: 5,

// Камера никогда не скроется автоматически
AUTO_LOCK_MINUTES: 0,
```

---

### DEBUG_MODE

**Тип:** `boolean`

**Описание:** Режим отладки. Когда включён, выводит в консоль браузера информацию о попытках разблокировки.

| Значение | Эффект |
|----------|--------|
| `true`   | Логирование включено (только в режиме разработки) |
| `false`  | Логирование отключено |

> **Важно:** Для продакшн-сборки всегда устанавливайте `false`.

**Пример:**
```typescript
// Для разработки и тестирования
DEBUG_MODE: true,

// Для продакшн
DEBUG_MODE: false,
```

---

## Схема сетки паттерна

### Визуальное представление

```
    Колонка 0   Колонка 1   Колонка 2
         ↓           ↓           ↓
    ┌─────────┬─────────┬─────────┐
    │         │         │         │
Строка 0 →   ●  (0)     ●  (1)     ●  (2)
    │         │         │         │
    ├─────────┼─────────┼─────────┤
    │         │         │         │
Строка 1 →   ●  (3)     ●  (4)     ●  (5)
    │         │         │         │
    ├─────────┼─────────┼─────────┤
    │         │         │         │
Строка 2 →   ●  (6)     ●  (7)     ●  (8)
    │         │         │         │
    └─────────┴─────────┴─────────┘
```

### Формула расчёта номера точки

```
Номер точки = (Строка × 3) + Колонка
```

**Примеры:**
- Верхний левый угол: Строка 0, Колонка 0 → `(0 × 3) + 0 = 0`
- Центр: Строка 1, Колонка 1 → `(1 × 3) + 1 = 4`
- Нижний правый угол: Строка 2, Колонка 2 → `(2 × 3) + 2 = 8`

---

## Примеры конфигурации

### Пример 1: Максимальная безопасность

```typescript
export const CONFIG = {
  PRIVACY_MODE: true,           // Принудительно включена конфиденциальность
  UNLOCK_GESTURE: 'patternUnlock' as GestureType,  // Разблокировка паттерном
  UNLOCK_PATTERN: '0-4-8-6-2',   // Сложный паттерн (5 точек, зигзаг)
  AUTO_LOCK_MINUTES: 1,          // Быстрая автоблокировка
  DEBUG_MODE: false,             // Отладка выключена
} as const;
```

### Пример 2: Опциональный режим конфиденциальности

```typescript
export const CONFIG = {
  PRIVACY_MODE: false,          // Пользователи сами решают
  UNLOCK_GESTURE: 'patternUnlock' as GestureType,
  UNLOCK_PATTERN: '0-3-6-7-8',   // L-образный паттерн (5 точек)
  AUTO_LOCK_MINUTES: 5,          // Более длительный таймер
  DEBUG_MODE: false,
} as const;
```

### Пример 3: Для разработки/тестирования

```typescript
export const CONFIG = {
  PRIVACY_MODE: true,
  UNLOCK_GESTURE: 'patternUnlock' as GestureType,
  UNLOCK_PATTERN: '0-1-2-5',     // Простой паттерн для тестов (4 точки)
  AUTO_LOCK_MINUTES: 0,          // Автоблокировка отключена
  DEBUG_MODE: true,              // Отладка включена
} as const;
```

---

## Сборка проекта

После изменения настроек в `config.ts` необходимо пересобрать проект.

### Команды сборки

```bash
# Стандартная сборка (Node.js сервер)
./build.sh

# Сборка с Go сервером
./build.sh --go

# Сборка с обфускацией JavaScript
./build.sh --obfuscate

# Полная очистка + сборка с Go и обфускацией
./build.sh --clean --go --obfuscate
```

### Опции build.sh

| Опция | Описание |
|-------|----------|
| `--go` | Собирает Go сервер вместо Node.js (бинарный файл + статика) |
| `--obfuscate` | Включает обфускацию JavaScript кода |
| `--clean` | Очищает папку `dist` перед сборкой |
| `--help` | Показывает справку |

### Результат сборки

После сборки файлы находятся в папке `dist/`:

```
dist/
├── public/          # Статические файлы (HTML, JS, CSS, иконки)
├── index.cjs        # Node.js сервер (если без --go)
├── server           # Go бинарник (если с --go)
└── run.sh           # Скрипт запуска
```

### Запуск собранного приложения

```bash
# Node.js вариант
cd dist && node index.cjs

# Go вариант
cd dist && ./server --static ./public

# Или через скрипт
cd dist && ./run.sh
```

---

## Можно ли изменить настройки после сборки?

### Краткий ответ: **НЕТ** ❌

### Подробное объяснение

Настройки из `config.ts` **компилируются** в JavaScript бандл во время сборки. Это означает:

1. **Значения "вшиваются"** в финальный JS файл
2. **Нет внешнего** файла конфигурации
3. **Нельзя изменить** настройки без пересборки

### Почему так сделано?

1. **Безопасность:** Секретный паттерн не должен быть легко изменяемым
2. **Производительность:** Нет необходимости загружать внешний файл
3. **Надёжность:** Нет риска случайного изменения или повреждения конфигурации

### Что делать, если нужно изменить настройки?

1. Отредактируйте файл `client/src/config.ts`
2. Пересоберите проект командой `./build.sh`
3. Разверните новую сборку

### Альтернатива: Переменные окружения (не реализовано)

Если требуется динамическая конфигурация, можно доработать проект:

1. Создать API endpoint, возвращающий конфигурацию
2. Загружать конфигурацию при запуске приложения
3. Хранить чувствительные данные на сервере

> **Примечание:** Текущая архитектура оптимизирована для развёртывания на статическом хостинге без бэкенда.

---

## Рекомендации по безопасности

### 1. Используйте patternUnlock

```typescript
// Рекомендуется ✅
UNLOCK_GESTURE: 'patternUnlock' as GestureType,

// Не рекомендуется ⚠️
UNLOCK_GESTURE: 'quickTaps' as GestureType,
```

**Причина:** Режим `quickTaps` имеет известную уязвимость безопасности.

### 2. Создавайте сложные паттерны

**Хорошие паттерны:**
- Используют 5+ точек
- Не представляют очевидные буквы (L, Z, N)
- Содержат "обратные" движения

**Примеры сложных паттернов:**
```typescript
// Звезда (5 точек, пересекающиеся линии)
UNLOCK_PATTERN: '0-4-2-6-8',

// Сложный путь (8 точек)
UNLOCK_PATTERN: '0-3-4-1-2-5-8-7',
```

### 3. Не используйте очевидные паттерны

**Избегайте:**
- `'0-1-2'` (горизонтальная линия)
- `'0-3-6'` (вертикальная линия)
- `'0-4-8'` (простая диагональ)

### 4. Включайте автоблокировку

```typescript
// Быстрая автоблокировка для чувствительных данных
AUTO_LOCK_MINUTES: 1,
```

### 5. Отключайте DEBUG_MODE в продакшне

```typescript
// Всегда false для продакшн-сборки
DEBUG_MODE: false,
```

### 6. Используйте обфускацию

```bash
./build.sh --obfuscate
```

Обфускация затрудняет обратную разработку и извлечение паттерна из кода.

---

## Часто задаваемые вопросы

### Q: Как узнать, какой паттерн установлен?

**A:** Посмотрите значение `UNLOCK_PATTERN` в файле `client/src/config.ts`. Если приложение уже собрано — паттерн находится в обфусцированном JS коде (сложно извлечь).

### Q: Что произойдёт, если забыть паттерн?

**A:** Придётся:
1. Изменить `UNLOCK_PATTERN` в `config.ts`
2. Пересобрать приложение
3. Развернуть новую версию

### Q: Можно ли полностью отключить режим конфиденциальности?

**A:** Да, установите `PRIVACY_MODE: false`. Пользователи смогут управлять режимом конфиденциальности через настройки приложения.

### Q: Сохраняются ли данные игры 2048?

**A:** Да, лучший результат сохраняется в localStorage браузера.

### Q: Работает ли режим конфиденциальности на мобильных устройствах?

**A:** Да, жесты (тапы и рисование паттерна) оптимизированы для сенсорных экранов.

### Q: Как изменить время автоблокировки?

**A:** 
- Если `PRIVACY_MODE: true` — только через изменение `config.ts` и пересборку
- Если `PRIVACY_MODE: false` — пользователи могут изменить в настройках приложения (слайдер 1-30 минут)

### Q: Безопасно ли хранить секретный паттерн в коде?

**A:** Паттерн компилируется в бандл и дополнительно может быть обфусцирован. Для большинства случаев это достаточный уровень безопасности. Если требуется более высокий уровень защиты, рекомендуется:
- Использовать обфускацию (`--obfuscate`)
- Хранить паттерн на сервере (требует доработки)

---

## Контрольный список перед развёртыванием

- [ ] Установлен сложный паттерн (5+ точек)
- [ ] Выбран режим `patternUnlock`
- [ ] `DEBUG_MODE` установлен в `false`
- [ ] Настроено время автоблокировки
- [ ] Проект собран с обфускацией (`--obfuscate`)
- [ ] Протестирована разблокировка паттерном
- [ ] Проверена работа автоблокировки

---

## История изменений документа

| Версия | Дата | Описание |
|--------|------|----------|
| 1.0 | 2025-11-29 | Первоначальная версия документации |
| 1.1 | 2025-11-30 | Переименовано с "режим маскировки" на "режим конфиденциальности" |

---

*Camera ZeroDay — Tactical Camera PWA*
