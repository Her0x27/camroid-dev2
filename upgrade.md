# Upgrade: Позиционирование прицела долгим нажатием

## Описание функции
Новая функция позволяет позиционировать прицел долгим нажатием на экране камеры:
- Удерживайте палец в нужной точке (настраиваемое время)
- При удержании отображается предварительная позиция прицела
- После удержания можно скорректировать позицию на замороженном кадре
- Цвет прицела определяется по пикселям в месте позиционирования
- Фото сохраняется с прицелом в выбранной позиции

## Чек-лист задач

### 1. Схема и настройки
- [x] Добавить `longPressDelay` в схему (300-1500мс, по умолчанию 500мс)
- [x] Добавить `manualAdjustment` в схему (boolean, по умолчанию false)

### 2. UI настроек (ReticleSection)
- [x] Добавить слайдер времени удержания
- [x] Добавить переключатель режима корректировки

### 3. Визуальный индикатор при удержании
- [x] Показывать полупрозрачный прицел во время удержания пальца

### 4. Режим корректировки
- [x] Заморозить кадр после долгого нажатия (статичное изображение)
- [x] Показать кнопки-иконки X (отмена) и ✓ (подтверждение)
- [x] Реализовать перетаскивание прицела на замороженном кадре
- [x] По нажатию ✓ — сделать фото с выбранной позицией
- [x] По нажатию X — отменить и вернуться к камере

### 5. Цвет прицела по позиции
- [x] Изменить определение цвета — брать пиксели из позиции прицела
- [x] Обновлять цвет при перемещении прицела

### 6. Переводы
- [x] Добавить переводы для новых настроек (ru/en)

---

## Прогресс

| Задача | Статус | Дата |
|--------|--------|------|
| Схема и настройки | ✅ Готово | 07.12.2025 |
| UI настроек | ✅ Готово | 07.12.2025 |
| Визуальный индикатор | ✅ Готово | 07.12.2025 |
| Режим корректировки | ✅ Готово | 07.12.2025 |
| Цвет по позиции | ✅ Готово | 07.12.2025 |
| Переводы | ✅ Готово | 07.12.2025 |

---
---

# Upgrade: Реорганизация настроек + мобильная адаптация

## Описание
Реорганизация страницы настроек для улучшения юзабилити и адаптации под мобильные устройства (Android/iOS):
- Группировка настроек по логическим категориям
- Панель быстрого доступа к часто используемым опциям
- Мобильная навигация с табами внизу экрана
- Увеличенные области касания для сенсорных экранов
- Поиск по настройкам

## Чек-лист задач

### 1. Панель быстрого доступа (QuickSettings)
- [x] Создать компонент QuickSettings с горизонтальной прокруткой
- [x] Добавить быстрые переключатели: стабилизация, GPS, звук затвора, тема
- [x] Стилизовать компактные иконки-кнопки с подписями
- [x] Добавить визуальную индикацию активного состояния

### 2. Группировка настроек по категориям
- [x] Создать 4 категории: Камера, Интерфейс, Данные, Система
- [x] **Камера**: Разрешение, качество фото, стабилизация, улучшение изображения
- [x] **Интерфейс**: Прицел (reticle), водяной знак, индикатор уровня, язык
- [x] **Данные**: GPS/локация, облачная загрузка, хранилище
- [x] **Система**: Тема, PWA, приватность, сброс настроек

### 3. Мобильная навигация (табы внизу экрана)
- [x] Создать компонент SettingsTabs для переключения категорий
- [x] Закрепить табы внизу экрана на мобильных (safe-area)
- [x] Добавить иконки и подписи к табам
- [x] Увеличить размер табов (min-height: 56px) для удобного касания
- [x] Добавить haptic feedback при переключении (если поддерживается)

### 4. Оптимизация UI для мобильных устройств
- [x] Увеличить размер переключателей (Switch) на мобильных
- [x] Увеличить высоту строк настроек (min-height: 56px)
- [x] Добавить правильные отступы для safe-area (iPhone notch, Android gesture bar)
- [x] Оптимизировать слайдеры для touch: увеличить область захвата
- [x] Добавить touch-manipulation для предотвращения задержек

### 5. Поиск по настройкам
- [x] Добавить поле поиска в заголовок
- [x] Реализовать показ всех секций при поиске
- [x] Добавить кнопку очистки поиска

### 6. Переводы
- [x] Добавить переводы для названий категорий (ru/en)
- [x] Добавить переводы для placeholder поиска
- [x] Добавить переводы для быстрых настроек

### 7. Тестирование
- [ ] Проверить на iOS Safari (iPhone)
- [ ] Проверить на Android Chrome
- [ ] Проверить safe-area на устройствах с "челкой"
- [ ] Проверить горизонтальную ориентацию

---

## Прогресс

| Задача | Статус | Дата |
|--------|--------|------|
| Панель быстрого доступа | ✅ Готово | 08.12.2025 |
| Группировка по категориям | ✅ Готово | 08.12.2025 |
| Мобильная навигация + haptic | ✅ Готово | 08.12.2025 |
| Оптимизация UI | ✅ Готово | 08.12.2025 |
| Поиск по настройкам | ✅ Готово | 08.12.2025 |
| Переводы | ✅ Готово | 08.12.2025 |
| Тестирование | ⏳ Ожидает | - |

---

## Архитектура решения

```
client/src/pages/settings/
├── index.tsx                    # Главная страница настроек
├── components/
│   ├── QuickSettings.tsx        # NEW: Панель быстрого доступа
│   ├── SettingsTabs.tsx         # NEW: Табы навигации по категориям
│   ├── SettingsSearch.tsx       # NEW: Поиск по настройкам
│   └── CategorySection.tsx      # NEW: Обёртка для категории
├── sections/
│   ├── ... (существующие секции)
└── hooks/
    └── useSettingsSearch.ts     # NEW: Хук для поиска
```

## Категории настроек

| Категория | Иконка | Секции |
|-----------|--------|--------|
| Камера | Camera | CameraSettings, ImageQuality |
| Интерфейс | Palette | Reticle, Watermark, General (язык) |
| Данные | Database | CaptureLocation, CloudUpload, Storage |
| Система | Settings | Theme, PWA, Privacy, Reset |

---

# Upgrade: Компактная навигация настроек (v2)

## Описание
Убрать нижнюю панель табов и заменить на компактный горизонтальный навигатор под шапкой для экономии экранного пространства на мобильных устройствах.

## Чек-лист задач

### 1. Новая навигация
- [x] Создать компонент `SettingsChips` - горизонтальный скролл категорий
- [x] Убрать `SettingsTabs` из settings/index.tsx
- [x] Убрать десктопную плавающую панель внизу
- [x] Интегрировать `SettingsChips` в sticky header

### 2. Оптимизация компонентов
- [x] Оптимизировать `QuickSettings` - компактная сетка 2x2
- [x] Убрать лишние отступы (pb-32 → pb-8)

### 3. Финализация
- [x] Обновить экспорты в `components/index.ts`
- [x] Протестировать на мобильных

---

## Прогресс v2

| Задача | Статус |
|--------|--------|
| Создать SettingsChips | ✅ Готово |
| Убрать SettingsTabs | ✅ Готово |
| Убрать десктопную панель | ✅ Готово |
| Интегрировать в header | ✅ Готово |
| Оптимизировать QuickSettings | ✅ Готово |
| Убрать лишние отступы | ✅ Готово |
| Обновить экспорты | ✅ Готово |
| Тестирование | ✅ Готово |

---

# Upgrade: Описания слайдеров и footer (v3)

## Описание
1. Добавить краткие описания для слайдеров качества и прицела
2. Уменьшить отступы между описанием и слайдером
3. Перенести блок appInfo из категории "Система" в footer всех вкладок

## Чек-лист задач

### 1. Описания слайдеров качества изображения
- [x] Добавить описание для "Резкость"
- [x] Добавить описание для "Подавление шума"
- [x] Добавить описание для "Контраст"

### 2. Описания слайдеров прицела
- [x] Добавить описание для "Размер"
- [x] Добавить описание для "Толщина"
- [x] Добавить описание для "Прозрачность"

### 3. Оптимизация отступов
- [x] Уменьшить отступы в SettingSlider (space-y-3 → space-y-2)

### 4. Footer
- [x] Убрать appInfo из категории system
- [x] Добавить appInfo в footer всех вкладок

### 5. Переводы
- [x] Добавить переводы описаний в en.ts
- [x] Добавить переводы описаний в ru.ts

---

## Прогресс v3

| Задача | Статус |
|--------|--------|
| Описания качества | ✅ Готово |
| Описания прицела | ✅ Готово |
| Уменьшить отступы | ✅ Готово |
| Footer на всех вкладках | ✅ Готово |
| Переводы | ✅ Готово |

---

# Upgrade: Live Preview для настроек прицела и водяного знака (v4)

## Описание
Реализовать live preview для настроек прицела и водяного знака:
- При изменении слайдеров прицела/водяного знака показывать полноэкранное превью
- Превью отображает тактическое фото с наложенным прицелом и водяным знаком
- Панель настроек становится полупрозрачной (glass effect) поверх превью
- Водяной знак показывает только активные элементы (GPS если включен, заметку если есть)

## Чек-лист задач

### 1. Подготовка ресурсов
- [x] Добавить тактическое фото для превью в assets

### 2. Компонент SettingsPreview
- [x] Создать полноэкранный overlay компонент
- [x] Рендерить прицел с текущими настройками (размер, толщина, прозрачность, цвет)
- [x] Рендерить водяной знак с учётом активных опций:
  - GPS координаты (если GPS включен)
  - Высота, точность, азимут (демо-данные)
  - Заметка (если showMetadata включен)
  - Временная метка
- [x] Масштабирование водяного знака по настройке watermarkScale

### 3. Контекст PreviewContext
- [x] Создать контекст для управления состоянием превью
- [x] Поддержка активации/деактивации превью
- [x] Отслеживание какая секция активировала превью

### 4. Интеграция с секциями настроек
- [x] Обновить ReticleSection — активация превью при взаимодействии со слайдерами
- [x] Обновить WatermarkSection — активация превью при взаимодействии со слайдерами

### 5. Стилизация
- [x] Glass effect для панели настроек когда превью активно
- [x] Плавные анимации появления/исчезновения превью

### 6. Переводы
- [x] Добавить переводы для демо-заметки превью (ru/en)

---

## Прогресс v4

| Задача | Статус | Дата |
|--------|--------|------|
| Фото для превью | ✅ Готово | 08.12.2025 |
| SettingsPreview компонент | ✅ Готово | 08.12.2025 |
| PreviewContext | ✅ Готово | 08.12.2025 |
| Интеграция с секциями | ✅ Готово | 08.12.2025 |
| Стилизация | ✅ Готово | 08.12.2025 |
| Переводы | ✅ Готово | 08.12.2025 |

---

## Архитектура решения

```
client/src/pages/settings/
├── index.tsx                    # Обёртка PreviewProvider
├── components/
│   ├── SettingsPreview.tsx      # NEW: Полноэкранный overlay с превью
│   └── ...
├── contexts/
│   └── PreviewContext.tsx       # NEW: Контекст для управления превью
└── sections/
    ├── ReticleSection.tsx       # UPDATED: onInteractionStart/End
    └── WatermarkSection.tsx     # UPDATED: onInteractionStart/End
```

## Поведение водяного знака в превью

| Элемент | Условие отображения |
|---------|---------------------|
| GPS координаты | settings.gpsEnabled === true |
| Высота | Всегда (демо-данные) |
| Точность GPS | settings.gpsEnabled === true |
| Азимут | Всегда (демо-данные) |
| Наклон | Всегда (демо-данные) |
| Заметка | settings.reticle.showMetadata === true |
| Timestamp | Всегда |

---

# Upgrade: Рефакторинг архитектуры (v5)

## Описание
Рефакторинг архитектуры приложения для расширяемости:
1. **Расширяемая система игр** — возможность добавлять новые игры для PRIVACY_MODE
2. **Расширяемая система тем** — возможность создавать и выбирать пользовательские темы
3. **Удаление quickTaps** — устаревший тип жеста с багом безопасности

## Чек-лист задач

### 1. Удаление GestureType: quickTaps
- [ ] Удалить 'quickTaps' из типа GestureType в config.ts
- [ ] Удалить 'quickTaps' из типа в privacy-context.tsx
- [ ] Удалить обработку quickTaps в use-secret-gesture.ts
- [ ] Удалить опцию quickTaps из PrivacySection.tsx
- [ ] Удалить переводы quickTaps из en.ts и ru.ts
- [ ] Обновить UNLOCK_GESTURE по умолчанию на 'patternUnlock'
- [ ] Удалить QUICK_TAP_COUNT из constants.ts

### 2. Расширяемая система игр для PRIVACY_MODE
- [ ] Создать `client/src/games/types.ts` — интерфейс GameConfig
- [ ] Создать `client/src/games/registry.ts` — реестр игр
- [ ] Переместить Game2048 в `client/src/games/game-2048/`
- [ ] Добавить поле `selectedGame` в PrivacySettings
- [ ] Создать `GameSelector` компонент для PrivacySection
- [ ] Обновить GamePage для динамического выбора игры
- [ ] Обновить favicon/title на основе metadata игры

### 3. Расширяемая система тем
- [ ] Создать `client/src/themes/types.ts` — интерфейс ThemeConfig
- [ ] Создать `client/src/themes/registry.ts` — реестр тем
- [ ] Создать `client/src/themes/tactical-dark.ts` — тёмная тема
- [ ] Создать `client/src/themes/tactical-light.ts` — светлая тема
- [ ] Обновить ThemeContext для поддержки кастомных тем
- [ ] Создать `ThemeSelector` компонент для ThemeSection
- [ ] Динамическая генерация CSS-переменных из конфига темы

### 4. Обновление документации
- [ ] Обновить replit.md с новой архитектурой
- [ ] Добавить примеры создания новых игр
- [ ] Добавить примеры создания новых тем

---

## Прогресс v5

| Задача | Статус | Дата |
|--------|--------|------|
| Удаление quickTaps | ⏳ В процессе | 09.12.2025 |
| Система игр | ⏳ Ожидает | - |
| Система тем | ⏳ Ожидает | - |
| Документация | ⏳ Ожидает | - |

---

## Архитектура: Система игр

```
client/src/games/
├── types.ts              # GameConfig interface
├── registry.ts           # GameRegistry: register/get games
├── index.ts              # Export all games
└── game-2048/
    ├── index.tsx         # Game2048 component
    ├── use-game.ts       # useGame2048 hook
    └── config.ts         # Metadata: title, favicon, icon
```

### GameConfig Interface
```typescript
interface GameConfig {
  id: string;                    // 'game-2048', 'game-snake'
  title: string;                 // Document title when active
  favicon: string;               // Path to favicon
  icon: React.ComponentType;     // Icon for selector
  component: React.LazyExoticComponent<GameComponent>;
}
```

## Архитектура: Система тем

```
client/src/themes/
├── types.ts              # ThemeConfig interface
├── registry.ts           # ThemeRegistry: register/get themes
├── apply-theme.ts        # Apply theme to DOM
├── index.ts              # Export all themes
├── tactical-dark.ts      # Default dark theme
└── tactical-light.ts     # Default light theme
```

### ThemeConfig Interface
```typescript
interface ThemeConfig {
  id: string;                    // 'tactical-dark', 'tactical-light'
  name: string;                  // Display name
  colors: {
    background: string;          // HSL values
    foreground: string;
    primary: string;
    // ... all CSS variables
  };
}
```
